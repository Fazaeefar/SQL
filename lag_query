SELECT o.OrderID, o.customerid, o.orderdate, od.orderdetailid, p.productid, od.quantity, p.price,
(od.quantity * p.price) as total,
lag(total, 1, 0) over (partition by o.customerid order by o.orderdate) as previousOrder
from Orders as o
join Customers as c
on c.CustomerID = o.CustomerID
join OrderDetails as od
on o.OrderID = od.OrderID
join Products as p
on p.ProductID = od.ProductID;
